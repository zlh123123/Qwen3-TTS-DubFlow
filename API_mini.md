# æ¦‚è¿°
æ ¸å¿ƒæµç¨‹ï¼šç”¨æˆ·ä¸Šä¼ å°è¯´ -> LLM åˆ†æè§’è‰² -> ç”¨æˆ·ç¡®è®¤/è°ƒæ•´äººè®¾ä¸å£°çº¿ -> LLM åˆ‡åˆ†å‰§æœ¬ -> æ‰¹é‡/å•å¥åˆæˆè¯­éŸ³ -> å¯¼å‡ºéŸ³é¢‘ã€‚
æŠ€æœ¯æ ˆï¼š
+ å‰ç«¯ï¼šReact
+ åç«¯ï¼šFastAPI + SQLite
+ AI
  + æœ¬åœ°éƒ¨ç½²ï¼šé‡‡ç”¨åŸºäºpytorchåº“çš„Qwen3TTSModeléƒ¨ç½²ï¼Œæ­¤éƒ¨åˆ†å°†é›†æˆåˆ°åç«¯ï¼ˆä¸æ¨èï¼Œé€Ÿåº¦æ…¢ï¼Œä¸”å¯¹æ˜¾å¡é…ç½®æœ‰è¦æ±‚ï¼Œæ˜“å‡ºç°ç¯å¢ƒé—®é¢˜ï¼‰
  + Autodléƒ¨ç½²ï¼šé‡‡ç”¨vllm-omniæ¨ç†æ¡†æ¶ï¼Œé€Ÿåº¦æ›´å¿«ï¼Œç©¿é€åˆ°æœ¬åœ°ä¸»æœºï¼ˆæ¨èå¤§éƒ¨åˆ†ç”¨æˆ·ä½¿ç”¨ï¼‰
  + è°ƒç”¨é˜¿é‡Œäº‘APIï¼ˆæ¨èå¤§éƒ¨åˆ†ç”¨æˆ·ä½¿ç”¨ï¼Œä¸Autodléƒ¨ç½²ç›¸æ¯”æˆæœ¬æ›´ä½ï¼‰
  + vllm-omniéƒ¨ç½²ï¼ˆä»…æ¨èlinuxç”¨æˆ·æˆ–è‡ªæœ‰linuxçš„é«˜æ€§èƒ½æœåŠ¡å™¨çš„ç”¨æˆ·ä½¿ç”¨ï¼Œä¸æ¨èwindowså’Œmacç”¨æˆ·éƒ¨ç½²ï¼Œæ˜“å‡ºç°ç¯å¢ƒé—®é¢˜ï¼‰

# æ–‡ä»¶æ ‘

```

Qwen3-DubFlow/
â”œâ”€â”€ .env                        # [å…¨å±€é…ç½®] æ ¹ç›®å½•ç¯å¢ƒå˜é‡ (ä¾› docker-compose è¯»å–ï¼Œå¦‚ PROJECT_NAME, GPU_IDS)
â”œâ”€â”€ docker-compose.yml          # [æ ¸å¿ƒç¼–æ’] å®šä¹‰ frontend å’Œ backend æœåŠ¡
â”œâ”€â”€ README.md                   # é¡¹ç›®è¯´æ˜æ–‡æ¡£
â”‚
â”œâ”€â”€ frontend/                   # [å‰ç«¯æœåŠ¡] React + Nginx
â”‚   â”œâ”€â”€ Dockerfile              # [æ„å»º] å¤šé˜¶æ®µæ„å»º: Nodeç¼–è¯‘ -> NginxæœåŠ¡ï¼Œå‰ç«¯é•œåƒä¸º Nginx + React
â”‚   â”œâ”€â”€ nginx.conf              # [é…ç½®] Nginx åå‘ä»£ç†é…ç½® (è½¬å‘ /api åˆ° backend, è½¬å‘ /static åˆ° storage)
â”‚   â”œâ”€â”€ package.json            # [ä¾èµ–] Node ä¾èµ–
â”‚   â”œâ”€â”€ public/                 # [èµ„æº] é™æ€èµ„æº
â”‚   â””â”€â”€ src/                    # [æºç ]
â”‚       â”œâ”€â”€ api/                # [API] axios å°è£… (projects.js, tasks.js)
â”‚       â”œâ”€â”€ hooks/              # [Hooks] è‡ªå®šä¹‰ Hooks (useTaskPoller.js)
â”‚       â”œâ”€â”€ pages/              # [é¡µé¢] (CreateProject, CharacterWorkshop, Studio)
â”‚       â”œâ”€â”€ components/         # [ç»„ä»¶] å…¬å…±ç»„ä»¶
â”‚       â”œâ”€â”€ App.js              # æ ¹ç»„ä»¶
â”‚       â””â”€â”€ index.js            # å…¥å£æ–‡ä»¶
â”‚
â”œâ”€â”€ backend/                    # [åç«¯æœåŠ¡] FastAPI
â”‚   â”œâ”€â”€ Dockerfile              # [æ„å»º] Python ç¯å¢ƒæ„å»º (å®‰è£… uv, ä¾èµ–)ã€‚
åç«¯é•œåƒå°†å‘å¸ƒä¸¤ä¸ªï¼š1.dubflow-backend:lite (ä»…æ”¯æŒ AutoDL/é˜¿é‡Œäº‘ï¼Œæ—  PyTorchï¼Œä½“ç§¯å°)2.dubflow-backend:full (æ”¯æŒæœ¬åœ°è¿è¡Œ/AutoDL/é˜¿é‡Œäº‘ï¼Œå« PyTorchï¼Œä½“ç§¯å¤§)
â”‚   â”œâ”€â”€ entrypoint.sh           # [å¯åŠ¨] å¯åŠ¨è„šæœ¬ 
â”‚   â”œâ”€â”€ .env                    # [å±€éƒ¨é…ç½®] åç«¯ä¸“ç”¨ç¯å¢ƒå˜é‡ (DB_URL)
â”‚   â”œâ”€â”€ pyproject.toml          # [ä¾èµ–] uv ä¾èµ–ç®¡ç†
â”‚   â”œâ”€â”€ uv.lock                 # [ä¾èµ–] é”å®šæ–‡ä»¶
â”‚   â”‚
â”‚   â”œâ”€â”€ main.py                 # [å…¥å£] FastAPI App åˆå§‹åŒ–
â”‚   â”œâ”€â”€ database.py             # [æ•°æ®åº“] SessionLocal, Base
â”‚   â”‚
â”‚   â”œâ”€â”€ models/                 # [ORM] æ•°æ®åº“è¡¨æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ project.py          # Project è¡¨å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ character.py        # Character è¡¨å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ script.py           # ScriptLine è¡¨å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ task.py             # ä»»åŠ¡é˜Ÿåˆ—è¡¨
â”‚   â”‚   â””â”€â”€ config.py           # ç”¨æˆ·è®¾ç½®è¡¨
â”‚   â”‚
â”‚   â”œâ”€â”€ schemas/                # [Pydantic] æ•°æ®æ ¡éªŒæ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ project.py          # ProjectCreate, ProjectResponse
â”‚   â”‚   â”œâ”€â”€ character.py        # CharacterUpdate
â”‚   â”‚   â””â”€â”€ common.py           # TaskResponse
â”‚   â”‚
â”‚   â”œâ”€â”€ routers/                # [è·¯ç”±] API æ¥å£å®ç°
â”‚   â”‚   â”œâ”€â”€ projects.py         # /api/projects
â”‚   â”‚   â”œâ”€â”€ characters.py       # /api/characters
â”‚   â”‚   â”œâ”€â”€ scripts.py          # /api/script
â”‚   â”‚   â”œâ”€â”€ synthesis.py        # /api/synthesis
â”‚   â”‚   â””â”€â”€ tasks.py            # /api/tasks
â”‚   â”‚
â”‚   â””â”€â”€ utils/                  # [å·¥å…·]
â”‚       â”œâ”€â”€ llm_helper.py       # LLM è°ƒç”¨å°è£…
â”‚       â””â”€â”€ audio_helper.py     # éŸ³é¢‘å¤„ç†å·¥å…·
â”‚
â”œâ”€â”€ models_deploy/              # [AIæ¨¡å‹æœåŠ¡] ç‹¬ç«‹çš„æ¨ç†ç¯å¢ƒ (GPU)ï¼Œæ­¤æœåŠ¡ä»…ç”¨äºAutodl ubuntuç¯å¢ƒéƒ¨ç½²
â”‚   â”œâ”€â”€ Dockerfile              # [æ„å»º] ç»Ÿä¸€çš„æ¨ç†é•œåƒ (PyTorch + vLLM + ä¾èµ–)
â”‚   â”œâ”€â”€ requirements.txt        # [ä¾èµ–] æ¨ç†æœåŠ¡æ‰€éœ€çš„ Python åŒ…
â”‚   â”œâ”€â”€ entrypoint.sh           # [å¯åŠ¨] å®¹å™¨å¯åŠ¨è„šæœ¬ (æ ¹æ®ç¯å¢ƒå˜é‡ TASK_TYPE å¯åŠ¨ä¸åŒæ¨¡å‹)
â”‚   â”‚
â”‚   â”œâ”€â”€ vllm_omni/              # [å¼•æ“] vllm-omni æºç  (Git Submodule)
â”‚   â”‚   â”œâ”€â”€ model_executor/     # æ¨¡å‹æ‰§è¡Œé€»è¾‘
â”‚   â”‚   â””â”€â”€ ...                 # å…¶ä»–æºç æ–‡ä»¶
â”‚   â”‚
â”‚   â””â”€â”€ models/                 # [æƒé‡] æ¨¡å‹æ–‡ä»¶æŒ‚è½½ç›®å½• (å®¿ä¸»æœºä¸‹è½½å¥½åæ˜ å°„è¿›å®¹å™¨)
â”‚       â”œâ”€â”€ Qwen3-TTS-12Hz-1.7B-VoiceDesign/  # æäººæ¨¡å‹æƒé‡
â”‚       â””â”€â”€ Qwen3-TTS-12Hz-1.7B-Base/         # åŸºç¡€æ¨¡å‹æƒé‡
â”‚
â””â”€â”€ storage/                    # [æŒä¹…åŒ–å­˜å‚¨] æŒ‚è½½åˆ°åç«¯å’Œ Nginx å®¹å™¨
    â”œâ”€â”€ uploads/                # åŸå§‹å°è¯´æ–‡ä»¶
    â”œâ”€â”€ temp/                   # ä¸´æ—¶éŸ³é¢‘ (Rerollç”¨)
    â””â”€â”€ projects/               # é¡¹ç›®æ•°æ®
        â””â”€â”€ {project_id}/       # æŒ‰é¡¹ç›®éš”ç¦»
            â”œâ”€â”€ voices/         # ç¡®è®¤çš„è§’è‰²å‚è€ƒéŸ³ (Ref Audio)
            â””â”€â”€ outputs/        # æœ€ç»ˆåˆæˆéŸ³é¢‘

```

# å‰ç«¯åŠŸèƒ½

+ ç”¨æˆ·æ‰“å¼€å‰ç«¯é¡µé¢æ—¶æ˜¾ç¤ºçš„ç¬¬ä¸€ä¸ªç•Œé¢ï¼Œæä¾›ä¸€ä¸ªæ–‡æœ¬è¾“å…¥æ¡†å’Œä¸€ä¸ªæ–‡ä»¶è¾“å…¥çš„é€‰é¡¹ã€‚æ–‡æœ¬è¾“å…¥æ¡†å¯ä»¥ç»Ÿè®¡å­—æ•°ç­‰ï¼›æ–‡ä»¶è¾“å…¥ç”¨æˆ·å¯ä»¥ç‚¹å‡»åé€‰æ‹©æœ¬åœ°è·¯å¾„çš„æ–‡ä»¶ï¼Œæˆ–è€…å°†æ–‡ä»¶æ‹–æ‹½è¿›å»ã€‚v1ç‰ˆæœ¬ä»…æ”¯æŒå°è¯´ã€‚v1ç‰ˆæœ¬ä¸­ä»…æ”¯æŒå•æ–‡ä»¶ï¼Œä¸”ä»…æ”¯æŒtxtæ–‡ä»¶ã€‚
+ ç¬¬äºŒä¸ªç•Œé¢ï¼Œä»…æ˜¾ç¤ºè§’è‰²åˆ—å’Œå¯¹è§’è‰²çš„ä¿®æ”¹æ§ä»¶ã€‚ç”¨æˆ·ç‚¹å‡»æ¯ä¸ªè§’è‰²çš„å¡ç‰‡ï¼Œå³å¯åœ¨ä¿®æ”¹æ§ä»¶ä¸­ä¿®æ”¹ç”±LLMç”Ÿæˆçš„è§’è‰²æè¿°ä¸éœ€è¦åˆæˆçš„å‚è€ƒéŸ³é¢‘çš„æ–‡æœ¬ï¼Œç‚¹å‡»rerollåå³å¯æäº¤TTSä»»åŠ¡ã€‚æ­¤å¤„éœ€è¦æ”¯æŒç”¨æˆ·è¿›è¡Œè§’è‰²çš„å¢åˆ ã€‚å½“ç”¨æˆ·ç¡®è®¤æ‰€æœ‰è§’è‰²çš„å‚è€ƒéŸ³é¢‘okï¼Œå¯ä»¥é€šè¿‡ç‚¹å‡»æŒ‰é’®è¿›åˆ°ä¸‹ä¸€æ­¥
+ ç¬¬ä¸‰ä¸ªç•Œé¢ï¼Œæ˜¾ç¤ºè§’è‰²åˆ—ã€å¯¹è¯åˆ—å’Œæ§ä»¶åˆ—ã€‚ç”¨æˆ·ç‚¹å‡»è§’è‰²å¡ç‰‡ï¼Œå¯ä»¥åœ¨æ§ä»¶ä¸­çœ‹åˆ°è§’è‰²æè¿°ã€å‚è€ƒéŸ³é¢‘æ–‡æœ¬ï¼ˆå¯æ˜¾ç¤ºä¸ºç°åº•ä»£è¡¨æ— æ³•ä¿®æ”¹ï¼‰ï¼Œå¹¶å¯å¬å‚è€ƒéŸ³é¢‘ã€‚ç”¨æˆ·ç‚¹å‡»å¯¹è¯å¡ç‰‡ï¼Œå¯ä»¥åœ¨æ§ä»¶ä¸­ä¿®æ”¹éœ€è¦åˆæˆçš„å¯¹è¯å†…å®¹ä»¥åŠä¿®æ”¹è¯­é€Ÿç­‰ï¼Œç‚¹å‡»rerollåå³å¯æäº¤TTSä»»åŠ¡ã€‚æ­¤å¤–éœ€è¦æ”¯æŒç”¨æˆ·è¿›è¡Œå¯¹è¯çš„å¢åˆ ã€‚è¿™é‡Œè¿˜å¯èƒ½å­˜åœ¨å¯¹è¯ä¸äººç‰©ä¸å¯¹åº”çš„é”™è¯¯æƒ…å†µï¼Œåœ¨æ§ä»¶ä¸­éœ€è¦æä¾›ä¿®æ”¹ç­–ç•¥ã€‚
+ ç¬¬ä¸‰ä¸ªç•Œé¢éœ€è¦æœ‰æ‰¹é‡åˆæˆé€‰é¡¹ï¼ŒåŒæ—¶ä¹ŸåŒ…æ‹¬æ ¹æ®ç­›é€‰æ¡ä»¶æ‰¹é‡åˆæˆçš„åŠŸèƒ½ï¼ˆå³ä»…åˆæˆæŸä¸ªäººç‰©ï¼Œä¸åˆæˆæ—ç™½ç­‰ï¼Œå¯ä»¥é€šè¿‡å¤šé€‰æ¡†çš„å½¢å¼æ„å»ºï¼‰ï¼›æ‰¹é‡å¯¼å‡ºåœ¨v1ç‰ˆä¸æä¾›ï¼Œæ‰¹é‡åˆæˆä¼šå°†éŸ³é¢‘ä¿å­˜è‡³æœ¬åœ°é»˜è®¤ä½ç½®ï¼›è¿˜éœ€è¦æä¾›è®¾ç½®æŒ‰é’®ï¼ŒåŒ…æ‹¬1ã€ç”¨æˆ·é€‰æ‹©çš„æ–‡æœ¬LLMçš„ç±»å‹ï¼ˆQwen or Deepseek or è‡ªå·±æœ¬åœ°éƒ¨ç½²æˆ–å…¶ä»–æ¨¡å‹ï¼‰ä¸API keyï¼Œ2ã€ç”¨æˆ·é€‰æ‹©çš„TTSæ¨¡å‹çš„æä¾›æ–¹å¼ï¼ˆæœ¬åœ°éƒ¨ç½² or Autodléƒ¨ç½²åç©¿é€ or è°ƒç”¨é˜¿é‡Œäº‘APIï¼‰ï¼Œv1ç‰ˆä»…æä¾›æœ¬åœ°éƒ¨ç½²å³å¯ï¼Œ3ã€ä¸€äº›å¤–è§‚åŠŸèƒ½ï¼ˆå¯è§†æƒ…å†µï¼Œv1ç‰ˆä¹Ÿå¯ä¸æä¾›ï¼‰ï¼Œ4ã€å¼€æºåè®®ä¸ç‰ˆæƒè¯´æ˜

## é¡µé¢ 1: é¡¹ç›®ä»ªè¡¨ç›˜

é¡¶éƒ¨å¯¼èˆªæ ï¼šQwen3-DubFlow Logo | è®¾ç½®æŒ‰é’® (GitHub, API Keyé…ç½®)

ä¸»ä½“å†…å®¹åŒºï¼š

+ æ–°å»ºå¡ç‰‡ (Big Button)ï¼šä¸€ä¸ªæ˜¾çœ¼çš„â€œ+ æ–°å»ºé¡¹ç›®â€å¤§å¡ç‰‡ã€‚
+ é¡¹ç›®åˆ—è¡¨ (Grid/List)ï¼šæŒ‰æ—¶é—´å€’åºæ’åˆ—çš„å¡ç‰‡ã€‚è¿™é‡Œä¹Ÿå¯ä»¥åŠ å…¥å„ç§ç­›é€‰æ˜¾ç¤ºçš„é€»è¾‘

é¡¹ç›®å¡ç‰‡å†…å®¹ï¼š

+ æ ‡é¢˜ï¼šã€Šæ–—ç ´è‹ç©¹ç¬¬ä¸€ç« ã€‹
+ çŠ¶æ€æ ‡ç­¾ï¼šğŸ”µ è§’è‰²åˆ†æä¸­ / ğŸŸ¢ å¾…åˆæˆ / âœ… å·²å®Œæˆï¼Œæ‰€æœ‰çš„æ ‡ç­¾è§ä¸Šé¢çš„æ•°æ®åº“
+ è¿›åº¦æ¡ï¼š(ä»…åœ¨ synthesizing çŠ¶æ€ä¸‹æ˜¾ç¤º) ä¾‹å¦‚ "35/100 å¥"
+ æ—¶é—´ï¼šåˆ›å»ºäº 2026-02-02
+ æ“ä½œï¼šç»§ç»­ç¼–è¾‘ã€åˆ é™¤é¡¹ç›®

---

**äº¤äº’é€»è¾‘ï¼š**

æ–°å»ºé¡¹ç›®ï¼š

ç‚¹å‡»â€œ+â€å· -> å¼¹å‡ºä¸€ä¸ª Modal (å¯¹è¯æ¡†) æˆ–è€…è·³è½¬åˆ°ä¸€ä¸ª ç®€å•çš„ Form é¡µé¢ã€‚

*æ­¤é¡µé¢å°±æ˜¯åŸæ¥çš„é¡µé¢1ï¼Œä¸è¿‡å»ºè®®åšæˆæ‚¬æµ®çš„å°çª—æ ·å¼*

æäº¤åï¼šå›åˆ°åˆ—è¡¨é¡µï¼Œåˆ—è¡¨ä¸­å¤šäº†ä¸€ä¸ª created çŠ¶æ€çš„å¡ç‰‡ã€‚

è¿›å…¥é¡¹ç›® (æ™ºèƒ½è·¯ç”±)ï¼š

ç”¨æˆ·ç‚¹å‡»å¡ç‰‡ã€‚

å‰ç«¯æ ¹æ® state åˆ¤æ–­è·³è½¬å“ªé‡Œï¼š

+ created / analyzing_characters / characters_ready -> è·³è½¬ Page 2 (è§’è‰²å·¥åŠ)
+ parsing_script / script_ready / synthesizing / completed -> è·³è½¬ Page 3 (æ¼”æ’­å®¤)

## é¡µé¢ 2: è§’è‰²å·¥åŠ 

åŠŸèƒ½ç›®æ ‡ï¼šç¡®è®¤ç”± LLM åˆ†æå‡ºçš„è§’è‰²è®¾å®šï¼Œå¹¶å®šå¦†éŸ³è‰²ã€‚

UI å¸ƒå±€ï¼š

+ å·¦ä¾§ï¼šè§’è‰²åˆ—è¡¨å¡ç‰‡ï¼ˆæ˜¾ç¤ºå¤´åƒ/åå­—ï¼‰ã€‚
+ å³ä¾§ï¼šç¼–è¾‘æ§ä»¶ã€‚

äº¤äº’é€»è¾‘ï¼š

+ åˆå§‹åŒ–ï¼šè¿›å…¥é¡µé¢è‡ªåŠ¨è§¦å‘ Analyze Characters å¼‚æ­¥ä»»åŠ¡ï¼Œæ˜¾ç¤º Loadingï¼Œå®Œæˆåæ¸²æŸ“åˆ—è¡¨ã€‚
+ è§’è‰²ç¼–è¾‘ï¼šç‚¹å‡»è§’è‰²å¡ç‰‡ï¼Œå³ä¾§æ˜¾ç¤ºï¼š

```
å§“å 

æ€§åˆ«

å¹´é¾„

äººè®¾æè¿°/Prompt (Text Area, ç”± LLM ç”Ÿæˆï¼Œå¯ä¿®æ”¹)

å‚è€ƒæ–‡æœ¬ (Text Area, ç”¨äºç”ŸæˆéŸ³è‰²çš„å°è¯ï¼Œå¯ä¿®æ”¹)
```

+ éŸ³è‰²è¯•å¬ (Reroll)ï¼šç‚¹å‡»â€œè¯•å¬/ç”Ÿæˆâ€æŒ‰é’® -> è§¦å‘ TTS ä»»åŠ¡ -> æ’­æ”¾ä¸´æ—¶éŸ³é¢‘ã€‚å¦‚æœä¸æ»¡æ„ï¼Œä¿®æ”¹ Prompt æˆ–å‚è€ƒæ–‡æœ¬åå†æ¬¡ç‚¹å‡»ã€‚
+ ç¡®è®¤éŸ³è‰²ï¼šç‚¹å‡»â€œç¡®è®¤ä½¿ç”¨â€ -> å°†å½“å‰è¯•å¬çš„éŸ³é¢‘é”å®šä¸ºè¯¥è§’è‰²çš„ ref_audioã€‚
+ å¢åˆ è§’è‰²ï¼šåˆ—è¡¨åº•éƒ¨æä¾›â€œæ·»åŠ è§’è‰²â€æŒ‰é’®ï¼›å¡ç‰‡å³ä¸Šè§’æä¾›â€œåˆ é™¤â€æŒ‰é’®ã€‚
+ ä¸‹ä¸€æ­¥ï¼šå½“ç”¨æˆ·ç¡®è®¤æ‰€æœ‰å…³é”®è§’è‰²åï¼Œç‚¹å‡»â€œç”Ÿæˆå‰§æœ¬â€è·³è½¬è‡³é¡µé¢ 3ã€‚

## é¡µé¢ 3: æ¼”æ’­å®¤ 

åŠŸèƒ½ç›®æ ‡ï¼šç²¾ä¿®å°è¯ï¼ŒæŒ‡æ´¾è§’è‰²ï¼Œåˆæˆæœ€ç»ˆéŸ³é¢‘ã€‚

UI å¸ƒå±€ï¼šä¸‰æ å¼å¸ƒå±€

+ å·¦æ  (è§’è‰²åº“)ï¼šæ˜¾ç¤ºæ‰€æœ‰å¯ç”¨è§’è‰²ï¼ˆæ–¹ä¾¿æ‹–æ‹½æˆ–æŸ¥çœ‹ï¼‰ã€‚
+ ä¸­æ  (å‰§æœ¬æµ)ï¼šå‚ç›´æ»šåŠ¨çš„å¯¹è¯å¡ç‰‡æµã€‚
+ å³æ  (æ§åˆ¶å°)ï¼šå½“å‰é€‰ä¸­å°è¯çš„è¯¦ç»†å‚æ•°ã€‚

äº¤äº’é€»è¾‘ï¼š

+ åˆå§‹åŒ–ï¼šè¿›å…¥é¡µé¢è‡ªåŠ¨è§¦å‘ Parse Script å¼‚æ­¥ä»»åŠ¡ã€‚
+ å‰§æœ¬å¡ç‰‡ï¼šæ¯å¼ å¡ç‰‡ä»£è¡¨ä¸€å¥å°è¯ï¼Œæ˜¾ç¤º è§’è‰²å¤´åƒ + å°è¯æ–‡æœ¬ã€‚
+ ä¿®æ”¹æ–‡æœ¬ï¼šç›´æ¥ç‚¹å‡»æ–‡æœ¬ç¼–è¾‘ã€‚
+ ä¿®æ”¹è§’è‰²ï¼šå‘ç° LLM åˆ†é…é”™è¯¯æ—¶ï¼Œç‚¹å‡»å¤´åƒä»ä¸‹æ‹‰æ¡†é‡æ–°æŒ‡æ´¾è§’è‰²ã€‚
+ å•å¥åˆæˆï¼šç‚¹å‡»å¡ç‰‡ä¸Šçš„â€œæ’­æ”¾/é‡è¯•â€æŒ‰é’®ï¼Œå•ç‹¬åˆæˆè¿™ä¸€å¥ã€‚
+ æ§åˆ¶å° (å³æ )ï¼šé€‰ä¸­æŸå¥å°è¯æ—¶ï¼Œå¯ä¿®æ”¹è¯¥å¥çš„ è¯­é€Ÿ ç­‰å‚æ•°ã€‚
+ æ­¤å¤–ï¼Œè¿˜éœ€è¦æä¾›å°è¯å¢åˆ åŠŸèƒ½

æ‰¹é‡æ“ä½œï¼š

+ ç­›é€‰åˆæˆï¼šCheckbox å‹¾é€‰â€œä»…åˆæˆæœªå®Œæˆçš„â€ã€â€œä»…åˆæˆä¸»è§’â€ã€â€œä¸ç”¨åˆæˆæ—ç™½â€ç­‰ï¼Œåæ­£å…¨éƒ½èƒ½é€‰ã€‚
+ å…¨éƒ¨åˆæˆï¼šç‚¹å‡»â€œæ‰¹é‡åˆæˆâ€ -> è§¦å‘åå°é˜Ÿåˆ—ã€‚

## è®¾ç½®å¼¹çª— 

LLM è®¾ç½®ï¼šé€‰æ‹©æ¨¡å‹ (Qwen/Deepseek/æœ¬åœ°éƒ¨ç½²)ã€å¡«å†™ API Keyã€‚

TTS è®¾ç½®ï¼šé€‰æ‹©åç«¯ (Local/Cloud)ã€æ˜¾å¡æŒ‡å®šã€‚ï¼ˆè¿™ä¸ªv1ç‰ˆä¸éœ€è¦ï¼‰

# æ•°æ®åº“è®¾è®¡

ç”¨æˆ·å¯ä»¥åˆ›å»ºå¤šä¸ªProjectã€‚åœ¨v1ç‰ˆä¸‹ï¼Œå³ä¸€ä¸ªprojectå¯¹åº”ä¸€ä¸ªå°è¯´çš„é…éŸ³ä»»åŠ¡ã€‚å…¶æ•°æ®åº“æ„æˆä¸ºï¼š

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
| :--- | :--- | :--- |
| id | String (UUID) | ä¸»é”® |
| name | String | é¡¹ç›®åç§° (é€šå¸¸æ˜¯å°è¯´åï¼Œç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰) |
| language | String | è¯­è¨€ï¼ŒTTSä»…æ”¯æŒChinese, English, Japanese, Korean, German, French, Russian, Portuguese, Spanish, Italian |
| raw_content | Text | å°è¯´åŸå§‹æ–‡æœ¬ |
| created_at | DateTime | åˆ›å»ºæ—¶é—´ |
| state | String | å½“å‰çŠ¶æ€ï¼Œå¯èƒ½çš„æ‰€æœ‰çŠ¶æ€å¦‚ä¸‹ |

| çŠ¶æ€å€¼ (State) | ä¸­æ–‡å«ä¹‰ | å‰ç«¯è¡Œä¸ºé€»è¾‘ | è§¦å‘æ¡ä»¶ |
| :--- | :--- | :--- | :--- |
| **created** | åˆå§‹çŠ¶æ€ | åœ¨æ•°æ®åº“ä¸­åˆå§‹åŒ–ä¸€ä¸ªprojectæ—¶çš„é»˜è®¤çŠ¶æ€ï¼Œç†è®ºä¸Šä¼šé©¬ä¸Šè¿›å…¥analyzing_characters |
| **analyzing_characters** | è§’è‰²åˆ†æä¸­ | åœ¨é¦–é¡µä¸Šä¸å…è®¸ç”¨æˆ·ç‚¹å‡»è¿™ä¸ªprojectï¼Œå‰ç«¯å¯ä»¥æ˜¾ç¤ºè½¬åœˆorloadingè¿™ç§ | projectçš„å†…å®¹å­˜è¿›æ•°æ®åº“ã€‚ç”¨æˆ·å·²ç»ä¸Šä¼ äº†å°è¯´æ–‡ä»¶ï¼Œç‚¹å‡»â€œåˆ†æè§’è‰²â€æŒ‰é’®ï¼ŒWorker å¼€å§‹è·‘ LLMã€‚ |
| **characters_ready** | è§’è‰²å¾…ç”¨æˆ·ç¡®è®¤å…¶éŸ³è‰² | ç‚¹å‡»è¿›å…¥â€œè§’è‰²å·¥åŠ (Page 2)â€ã€‚ | LLM åˆ†æå®Œæˆï¼ŒCharacter è¡¨æœ‰æ•°æ®äº†ã€‚ç°åœ¨ç”¨æˆ·å¼€å§‹è¯•å¬å¹¶ä¿®æ”¹éŸ³è‰² |
| **parsing_script** | å‰§æœ¬åˆ‡åˆ†ä¸­ | å‰ç«¯è¿™å—å›åˆ°é¦–é¡µï¼Œåˆ—è¡¨é¡µæ˜¾ç¤º Loadingï¼›ç¦æ­¢æ“ä½œã€‚ | ç”¨æˆ·åœ¨ Page 2 ç‚¹å‡»â€œç”Ÿæˆå‰§æœ¬â€ï¼ŒWorker å¼€å§‹è·‘ LLMã€‚æ­¤æ—¶ç”¨æˆ·å°±ä¸èƒ½å†å›åˆ°â€œè§’è‰²å·¥åŠ (Page 2)â€äº† |
| **script_ready** | å‰§æœ¬å°±ç»ª/å¾…åˆæˆ | ç”¨æˆ·åœ¨é¦–é¡µç‚¹å‡»é¡¹ç›®åï¼Œè¿›å…¥â€œæ¼”æ’­å®¤ (Page 3)â€ã€‚ | å‰§æœ¬åˆ‡åˆ†å®Œæˆï¼ŒScriptLine è¡¨æœ‰æ•°æ®äº†ã€‚ |
| **synthesizing** | åˆæˆè¿›è¡Œä¸­ | åˆ—è¡¨é¡µæ˜¾ç¤ºè¿›åº¦æ¡ï¼›Page 3 é”å®šæ‰¹é‡åˆæˆæŒ‰é’®ã€‚ | ç”¨æˆ·ç‚¹å‡»äº†â€œæ‰¹é‡åˆæˆâ€ï¼Œåå°æ­£åœ¨ç–¯ç‹‚è·‘ GPUã€‚ |
| **completed** | å·²å®Œæˆ | åˆ—è¡¨é¡µæ˜¾ç¤ºâ€œå®Œæˆâ€è§’æ ‡ï¼›Page 3 å…è®¸å¯¼å‡ºã€‚ | æ‰€æœ‰çš„ ScriptLine status éƒ½å˜æˆäº† synthesizedã€‚ |
| **failed** | å¤„ç†å¤±è´¥ | åˆ—è¡¨é¡µæ˜¾ç¤ºçº¢è‰²è­¦å‘Šï¼Œå…è®¸ç”¨æˆ·â€œé‡è¯•â€ã€‚ | ä»»ä½•ä¸€ä¸ªä»»åŠ¡æŠ›å‡ºå¼‚å¸¸ (å¦‚æ˜¾å­˜æº¢å‡ºã€LLM è¶…æ—¶)ã€‚ |


æ¯ä¸ªProjectä¸­åŒ…å«ä¸€å¼ è§’è‰²è¡¨å’Œå¯¹è¯è¡¨ã€‚å…¶æ„æˆä¸ºï¼š

è§’è‰²è¡¨ï¼š
Character (è§’è‰²è¡¨)
| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
| :--- | :--- | :--- |
| id | Integer | ä¸»é”® |
| project_id | String (FK) | å¤–é”®å…³è” Project |
| name | String | è§’è‰²å (å¦‚: è§ç‚) |
| gender | String | male/female/è¿˜æœ‰é‚£ç§è™šæ‹Ÿçš„æœªçŸ¥çš„ |
| age | String | å¯ä»¥æ˜¯æ•°å­—ï¼Œä¹Ÿå¯ä»¥æ˜¯å¤§è‡´çš„æè¿°ï¼Œä¾‹å¦‚ä¸­å¹´äºº |
| description | Text | äººè®¾æè¿° (ç”¨äº LLM æŒ‡ä»¤) |
| prompt | Text | éŸ³è‰²æç¤ºè¯ (Timbre Prompt) |
| is_confirmed | Boolean | ç”¨æˆ·æ˜¯å¦å·²ç»ç¡®è®¤éŸ³è‰² |
| ref_audio_path | String | å®šå¦†éŸ³é¢‘è·¯å¾„ (ç”¨æˆ·ç¡®è®¤åçš„ wav è·¯å¾„) |
| duration | Float | éŸ³é¢‘æ—¶é•¿(ç§’)|
| ref_text | String | ç”Ÿæˆå®šå¦†éŸ³é¢‘æ—¶ç”¨çš„é‚£å¥è¯ |


å¯¹è¯è¡¨ï¼š

ScriptLine
| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
| :--- | :--- | :--- |
| id | Integer | ä¸»é”® |
| project_id | String (FK) | å¤–é”®å…³è” Project |
| character_id | Integer (FK)| å¤–é”®å…³è” Character |
| order_index | Integer | å°è¯é¡ºåº (1, 2, 3...) |
| text | Text | å°è¯å†…å®¹ |
| speed | Float | è¯­é€Ÿ |
| audio_path | String | åˆæˆåçš„éŸ³é¢‘è·¯å¾„ (æœªåˆæˆä¸º Null) |
| duration | Float | éŸ³é¢‘æ—¶é•¿(ç§’)|
| status | String | pending / synthesized / failed |

ä»»åŠ¡é˜Ÿåˆ—è¡¨ï¼š
Task (ä»»åŠ¡è¡¨)
| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
| :--- | :--- | :--- |
| id | String (UUID) | ä»»åŠ¡ ID (å¯¹åº” API è¿”å›çš„ task_id) |
| project_id | String (FK to projects.id) | å¤–é”®å…³è” Projectï¼Œç”¨äºåˆ¤æ–­projectæ‰€å¤„çš„çŠ¶æ€ |
| type | String | ä»»åŠ¡ç±»å‹: analyze_char, parse_script, synthesis |
| status | String | pending (æ’é˜Ÿ), processing (è¿›è¡Œä¸­), success, failed |
| payload | JSON | ä»»åŠ¡å‚æ•° (å¦‚: {"text": "ä½ å¥½", "char_id": 1}) |
| result | JSON | ä»»åŠ¡ç»“æœ (å¦‚: {"audio_url": "/static/..."}) |
| error_msg | Text | æŠ¥é”™ä¿¡æ¯ |
| created_at | DateTime | ç”¨äºæ’é˜Ÿé¡ºåº (ORDER BY created_at) |


æ¯ä¸ªç”¨æˆ·è¿˜æœ‰ä¸€å¼ é…ç½®è¡¨ã€‚å…¶é…ç½®ä¸ºï¼š

Config
| å­—æ®µå | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹å€¼ |
| :--- | :--- | :--- | :--- |
| **key** | String (PK) | å”¯ä¸€é”®å (å»ºè®®ç”¨ç‚¹åˆ†æ³•) | `llm.deepseek.api_key` |
| **value** | Text | é…ç½®å€¼ (ä¸è®ºä»€ä¹ˆç±»å‹éƒ½è½¬å­—ç¬¦ä¸²å­˜) | `sk-123456` |
| **group** | String | åˆ†ç»„ (ç”¨äºå‰ç«¯ Tab åˆ‡æ¢) | `llm_settings` |
| **label** | String | å‰ç«¯æ˜¾ç¤ºçš„ä¸­æ–‡åç§° | `DeepSeek API Key` |
| **type** | String |  æ§ä»¶ç±»å‹ | `password` / `text` / `select` / `boolean` / `color` |
| **options** | JSON | å¦‚æœæ˜¯ selectï¼Œè¿™é‡Œå­˜é€‰é¡¹ | `["deepseek", "qwen", "openai"]` |
| **default** | String | é»˜è®¤å€¼ | `deepseek` |
| **is_public** | Boolean | æ˜¯å¦å…¬å¼€ (éƒ¨åˆ†é…ç½®å¯èƒ½ä¸ç»™å‰ç«¯çœ‹) | `true` |

A. appearance (å¤–è§‚ä¸äº¤äº’)

| Key | Label | Type | Options / Default | è¯´æ˜ |
| :--- | :--- | :--- | :--- | :--- |
| `app.theme_mode` | ä¸»é¢˜æ¨¡å¼ | `select` | `["light", "dark", "system"]` | æ˜äº®/æš—é»‘/è·Ÿéšç³»ç»Ÿ |
| `app.language` | è¯­è¨€ | `select` | `["zh-CN", "en-US", "ja-JP"]` | å›½é™…åŒ–æ”¯æŒ |

B. llm_settings (LLMè®¾ç½®)

| Key | Label | Type | Default | è¯´æ˜ |
| :--- | :--- | :--- | :--- | :--- |
| `llm.active_provider` | å½“å‰ LLM æœåŠ¡å•† | `select` | `deepseek` | ä¸‹æ‹‰é€‰ DeepSeek/Qwen/Self-defined |
| `llm.deepseek.api_key` | DeepSeek API Key | `password` | - | å­˜å¯†é’¥ï¼Œå‰ç«¯æ˜¾ç¤ºä¸º ****** |
| `llm.qwen.api_key` | Qwen API Key | `password` | - | å­˜å¯†é’¥ï¼Œå‰ç«¯æ˜¾ç¤ºä¸º ****** |
| `llm.selfdef.url` | è‡ªå®šä¹‰ LLM åœ°å€ | `text` | `http://localhost:11434` | Ollama ç­‰æœ¬åœ°æœåŠ¡åœ°å€ or å…¶ä»–LLMä¾›åº”å•†çš„API URL |
| `llm.selfdef.api_key` | è‡ªå®šä¹‰ LLM API Key | `password` | - | æœ¬åœ°æœåŠ¡ä¸éœ€è¦keyï¼Œå…¶ä»–LLMä¾›åº”å•†éœ€è¦key |

C. tts_settings (è¯­éŸ³åˆæˆè®¾ç½®)

| Key | Label | Type | Default | è¯´æ˜ |
| :--- | :--- | :--- | :--- | :--- |
| `tts.backend` | TTS åç«¯ç±»å‹ | `select` | - | é€‰é¡¹: local_pytorch / local_vllm / autodl / aliyun |
| **æœ¬åœ°pytorchéƒ¨ç½²** | | | | |
| `tts.local.model_base_path` | å…‹éš†æ¨¡å‹è·¯å¾„ | `text` | - | - |
| `tts.local.model_vd_path` | è®¾è®¡æ¨¡å‹è·¯å¾„ | `text` | - | - |
| `tts.local.device` | è®¡ç®—è®¾å¤‡ | `select` | cuda | cuda or cpu |
| **æœ¬åœ°vllméƒ¨ç½²** | | | | |
| `tts.vllm.url` | vllmæœåŠ¡åœ°å€ | `text` | `http://localhost:8000` | Docker å®¹å™¨å†…éƒ¨åœ°å€ |
| **autodlç©¿é€** | | | | |
| `tts.autodl.base_port` | åŸºç¡€æ¨¡å‹æœ¬åœ°ç«¯å£ | `text` | 6006 | - |
| `tts.autodl.vd_port` | æäººæ¨¡å‹æœ¬åœ°ç«¯å£ | `text` | 6007 | - |
| **é˜¿é‡Œäº‘API** | | | | |
| `tts.aliyun.api_key` | DashScope API Key | `password` | - | - |
| `tts.aliyun.region` | æœåŠ¡åŒºåŸŸ | `select` | `beijing` | é€‰é¡¹: beijing / singaporeï¼Œå›½å†…beijingï¼Œå›½å¤– singapore |



D. synthesis_config (åˆæˆç­–ç•¥ä¸é«˜çº§å‚æ•°)

| Key | Label | Type | Default | è¯´æ˜ |
| :--- | :--- | :--- | :--- | :--- |
| **åŸºç¡€è®¾ç½®** | | | | |
| `syn.default_speed` | é»˜è®¤è¯­é€Ÿ | `number` | `1.0` | å»ºè®®èŒƒå›´ 0.8 - 1.5 æ¯”è¾ƒè‡ªç„¶ã€‚ |
| `syn.silence_duration` | å¥é—´é™éŸ³æ—¶é•¿ | `number` | `0.5` | å•ä½ï¼šç§’ã€‚åˆæˆé•¿éŸ³é¢‘æ—¶ï¼Œæ¯å¥è¯ä¹‹é—´æ’å…¥çš„ç©ºç™½åœé¡¿ã€‚ |
| `syn.export_path` | é»˜è®¤å¯¼å‡ºè·¯å¾„ | `text` | `/data/outputs` | å®¹å™¨å†…è·¯å¾„ï¼Œéœ€æŒ‚è½½å¯¹åº”å®¿ä¸»æœº storage ç›®å½•ã€‚ |
| `syn.max_workers` | æœ€å¤§å¹¶å‘æ•° | `number` | `2` | é™åˆ¶åŒæ—¶åˆæˆä»»åŠ¡æ•°ã€‚é˜²æ­¢æ˜¾å­˜æº¢å‡º (OOM) çš„å…³é”®ã€‚ |
| **éŸ³é¢‘å¤„ç†** | | | | |
| `syn.volume_gain` | éŸ³é‡å¢ç›Š | `number` | `1.0` | 1.0 ä¸ºåŸå£°ã€‚é’ˆå¯¹å£°éŸ³åå°çš„æ¨¡å‹å¯è®¾ä¸º 1.2 æˆ– 1.5ã€‚ |
| `syn.audio_format` | éŸ³é¢‘å¯¼å‡ºæ ¼å¼ | `select` | `wav` | `["wav", "mp3"]`ã€‚wav æ— æŸï¼Œmp3 ä½“ç§¯å°ã€‚ |
| **æ–‡æœ¬é¢„å¤„ç†** | | | | |
| `syn.auto_slice` | è‡ªåŠ¨åˆ‡åˆ†è¿‡é•¿æ–‡æœ¬ | `boolean` | `true` | å¼€å¯åé˜²æ­¢å•å¥è¶…è¿‡æ¨¡å‹å­—ç¬¦é™åˆ¶å¯¼è‡´æŠ¥é”™ã€‚ |
| `syn.text_clean` | æ–‡æœ¬æ¸…æ´— | `boolean` | `true` | è‡ªåŠ¨å»é™¤æ— æ³•æœ—è¯»çš„ç‰¹æ®Šç¬¦å·ï¼ˆå¦‚ âœ¨, ---, [] ç­‰ï¼‰ã€‚ |


é™¤äº†ç”¨æˆ·é…ç½®è¡¨å¤–ï¼Œé¡¹ç›®åç«¯è¿è¡Œè¿˜éœ€è¦ä¸€äº›é…ç½®ï¼Œè¿™äº›é…ç½®æ”¾åœ¨.envç¯å¢ƒå˜é‡ä¸­ï¼Œä»…å¼€å‘äººå‘˜ä½¿ç”¨ï¼Œæ™®é€šç”¨æˆ·ä¸ä½¿ç”¨

+ .envä¸­åŒ…æ‹¬æ•°æ®åº“åœ°å€ã€å¯†é’¥è¿™äº›ã€‚ç”±å¼€å‘/è¿ç»´äººå‘˜ç®¡ç†ï¼Œä»£ç è¿è¡Œå‰å°±å¿…é¡»å­˜åœ¨ï¼Œä¸€æ—¦ä¿®æ”¹é€šå¸¸éœ€è¦é‡å¯æœåŠ¡ã€‚
+ UserConfigåˆ™ç”±ç”¨æˆ·åœ¨å‰ç«¯ UI ä¿®æ”¹ï¼Œå®æ—¶ç”Ÿæ•ˆï¼Œä¸éœ€è¦é‡å¯æœåŠ¡ã€‚

# APIæ–‡æ¡£

**æ‰€æœ‰è¯·æ±‚ä½“ (Request Body) å’Œå“åº”ä½“ (Response Body) å‡ä¸º JSONï¼›è€—æ—¶ä»»åŠ¡ï¼ˆå¦‚åˆ†æã€åˆæˆï¼‰å‡é‡‡ç”¨ å¼‚æ­¥æ¨¡å¼ (è¿”å› task_id)ã€‚**

## é¡µé¢ 1: é¡¹ç›®ä»ªè¡¨ç›˜

#### åˆ›å»ºé¡¹ç›®

URL: POST /api/projects

Request:

```
{
  "name": "æ–—ç ´è‹ç©¹ç¬¬ä¸€ç« ",
  "content": "è¿™é‡Œæ˜¯å°è¯´å…¨æ–‡å†…å®¹..."
}
```

Response:
```
{ "id": "uuid-gen-001", "name": "...", "created_at": "..." }
```

#### è·å–æ‰€æœ‰çš„project

URL: GET /api/projects

Responseï¼š

```
{
  "total": 5,
  "items": [
    {
      "id": "uuid-001",
      "name": "æ–—ç ´è‹ç©¹",
      "state": "synthesizing",
      "created_at": "2026-02-02T10:00:00"
    },
    {
      "id": "uuid-002",
      "name": "å‡¡äººä¿®ä»™ä¼ ",
      "state": "characters_ready",
      "created_at": "2026-02-01T14:20:00"
    }
  ]
}
```

#### è·å–å•ä¸ªprojectçš„è¯¦æƒ…

URL: GET /api/projects/{pid}

Responseï¼š

```
{
  "id": "uuid-001",
  "name": "æ–—ç ´è‹ç©¹",
  "state": "script_ready", // å‰ç«¯æ ¹æ®è¿™ä¸ªå­—æ®µå†³å®šè·¯ç”±
  "raw_content_preview": "è¿™é‡Œæ˜¯å°è¯´å‰100å­—..."
}
```

#### åˆ é™¤é¡¹ç›®

URL: DELETE /api/projects/{pid}

åç«¯ä¸ä»…è¦åˆ æ•°æ®åº“é‡Œçš„è®°å½•ï¼Œè¿˜è¦çº§è”åˆ é™¤ç£ç›˜ä¸Š storage/projects/{pid}/ ä¸‹çš„æ‰€æœ‰éŸ³é¢‘æ–‡ä»¶

## é¡µé¢ 2: è§’è‰²å·¥åŠ

#### è°ƒç”¨LLMè§’è‰²åˆ†æ (å¼‚æ­¥)

URL: POST /api/projects/{pid}/characters/analyze
ä¼ å‚ä¸ºéœ€è¦åˆ†æçš„projectçš„idï¼Œè§¦å‘ LLM é˜…è¯»å°è¯´å¹¶æå–è§’è‰²ã€‚
Response: { "task_id": "task_char_001" }

#### è·å–è§’è‰²åˆ—è¡¨

URL: GET /api/projects/{pid}/characters
Response:
```
[
  {
    "id": 101,
    "name": "è§ç‚",
    "gender": "male",
    "age":"18å²",
    "description": "åšæ¯…çš„å°‘å¹´...",
    "ref_text": "ä¸‰åå¹´æ²³ä¸œï¼Œä¸‰åå¹´æ²³è¥¿ï¼",
    "ref_audio_url": "/static/voices/101_confirmed.wav" // è‹¥æœªå®šå¦†åˆ™ä¸º null
  }
]
```

#### ä¿®æ”¹è§’è‰²ä¿¡æ¯

URL: PUT /api/characters/{char_id}

Request:
```
{
  "name": "è§ç‚(ä¿®æ”¹ç‰ˆ)",
 "gender": "male",
    "age":"18å²",
  "description": "å£°éŸ³æ›´åŠ ä½æ²‰...",
  "ref_text": "è«æ¬ºå°‘å¹´ç©·ï¼"
}
```

#### éŸ³è‰²è¯•å¬/Reroll (å¼‚æ­¥)

URL: POST /api/voices/preview

æ ¹æ®å½“å‰å‚æ•°ç”Ÿæˆä¸€ä¸ªä¸´æ—¶éŸ³é¢‘ï¼Œ**ä¸ä¿å­˜åˆ°æ•°æ®åº“**ã€‚

Request:
```
{
  "character_id": 101,
  "text": "è«æ¬ºå°‘å¹´ç©·ï¼", // è¯•å¬æ–‡æœ¬
  "instruct": "å£°éŸ³ä½æ²‰ï¼Œå……æ»¡æ€’ç«" // æç¤ºè¯
}
```

Response: { "task_id": "task_preview_001" }

å‰ç«¯è½®è¯¢è¯¥ä»»åŠ¡æˆåŠŸåï¼Œä¼šæ‹¿åˆ°ä¸€ä¸ªä¸´æ—¶ URL ( /static/temp/preview_xyz.wavè¿™ç§)

#### ç¡®è®¤éŸ³è‰²

URL: POST /api/characters/{char_id}/confirm_voice

ç”¨æˆ·å¯¹æŸæ¬¡è¯•å¬æ»¡æ„ï¼Œå°†è¯¥ä¸´æ—¶æ–‡ä»¶å›ºåŒ–ä¸ºè§’è‰²çš„å‚è€ƒéŸ³é¢‘ã€‚

Request:
```
{
  "temp_audio_task_id": "task_preview_001" // æŒ‡æ˜æ˜¯å“ªä¸€æ¬¡ç”Ÿæˆçš„ç»“æœ
}
```

## é¡µé¢ 3: æ¼”æ’­å®¤ 

#### è§¦å‘å‰§æœ¬åˆ‡åˆ† (å¼‚æ­¥)

URL: POST /api/projects/{pid}/script/parse

LLM å°†åŸæ–‡åˆ‡åˆ†ä¸ºå¯¹è¯åˆ—è¡¨ã€‚

Response: { "task_id": "task_script_001" }

#### è·å–å‰§æœ¬è¯¦æƒ…

URL: GET /api/projects/{pid}/script

Response:
```
[
  {
    "id": 5001,
    "character_id": 101,
    "character_name": "è§ç‚", // å†—ä½™å­—æ®µæ–¹ä¾¿å‰ç«¯å±•ç¤º
    "text": "è€å¸ˆï¼Œæˆ‘ä»¬èµ°å§ã€‚",
    "audio_url": null,
    "status": "pending"
  },
  {
    "id": 5002,
    "character_id": 102, // è¯è€
    "text": "å¥½ï¼Œå°å®¶ä¼™ã€‚",
    "audio_url": "/static/outputs/line_5002.wav",
    "status": "synthesized"
  }
]
```

#### ä¿®æ”¹å•å¥å°è¯

URL: PUT /api/script/{line_id}

Request:
```
{
  "character_id": 103, // ä¿®æ”¹è¯´è¯äºº
  "text": "è€å¸ˆï¼Œç­‰ç­‰ï¼" // ä¿®æ”¹æ–‡æœ¬
}
```

#### æäº¤åˆæˆä»»åŠ¡ (å¼‚æ­¥ - æ‰¹é‡æˆ–å•å¥)

URL: POST /api/synthesis

Request:
```
{
  "project_id": "uuid-gen-001",
  "line_ids": [5001, 5003] // ä¼ å…¥è¦åˆæˆçš„å°è¯IDåˆ—è¡¨ã€‚å¦‚æœæ˜¯å•å¥è¯•å¬ï¼Œåˆ—è¡¨é‡Œå°±æ”¾ä¸€ä¸ªIDã€‚
}
```

Response: { "task_id": "task_syn_batch_001" }

## ç³»ç»Ÿé…ç½®é¡µ

#### è·å–é…ç½®

URL: GET /api/settings

Response (æŒ‰ç…§ Group åˆ†ç»„è¿”å›):
```
{
  "appearance": [
    {
      "key": "app.theme_mode",
      "value": "light",
      "label": "ä¸»é¢˜æ¨¡å¼",
      "type": "select",
      "options": ["light", "dark", "system"],
      "default": "system"
    }
  ],
  "llm_settings": [
    {
      "key": "llm.active_provider",
      "value": "deepseek",
      "label": "å½“å‰ LLM æœåŠ¡å•†",
      "type": "select",
      "options": ["deepseek", "qwen", "local"]
    },
    {
      "key": "llm.deepseek.api_key",
      "value": "sk-******", // æ³¨æ„ï¼šåç«¯åº”è„±æ•è¿”å›
      "label": "DeepSeek API Key",
      "type": "password"
    }
  ],
  "tts_settings": [
    {
      "key": "tts.active_backend",
      "value": "local_docker",
      "label": "TTS åç«¯ç±»å‹",
      "type": "select",
      "options": ["local_docker", "remote_autodl", "aliyun"]
    }
  ],
  "synthesis_config": [
    {
      "key": "syn.silence_duration",
      "value": "0.5",
      "label": "å¥é—´é™éŸ³æ—¶é•¿",
      "type": "number",
      "default": "0.5"
    }
  ]
}
```
#### æ›´æ–°é…ç½®

URL: PUT /api/settings
å‰ç«¯åªä¼ ä¿®æ”¹äº†çš„ KV å¯¹ã€‚

Request: 

```
{
  "updates": [
    { "key": "llm.active_provider", "value": "local" },
    { "key": "llm.local.url", "value": "http://localhost:11434" }
  ]
}
```

## é€šç”¨è½®è¯¢æ¥å£

ç”¨æ¥æŸ¥è¯¢è¿™é‡Œæ‰€æœ‰å¼‚æ­¥ä»»åŠ¡è¿›è¡Œçš„çŠ¶æ€

URL: GET /api/tasks/{task_id}

çŠ¶æ€å®šä¹‰:

+ pending: æ’é˜Ÿä¸­ (ä»»åŠ¡å·²æäº¤åˆ°é˜Ÿåˆ—ï¼ŒWorker å°šæœªæ¥å•)
+ processing: å¤„ç†ä¸­ (AI æ­£åœ¨æ¨ç†)
+ success: æˆåŠŸ (å¤„ç†å®Œæˆï¼Œè¿”å›ç»“æœ)
+ failed: å¤±è´¥ (ä»£ç æŠ¥é”™æˆ–èµ„æºä¸è¶³)

Response (Pending - æ’é˜Ÿä¸­):
```
{ 
  "status": "pending",
  "position": 3 // (å¯é€‰) å½“å‰é˜Ÿåˆ—æ’é˜Ÿä½ç½®
}
```


Response (Processing - å¤„ç†ä¸­):
```
//åˆ†æ/å‰§æœ¬ä»»åŠ¡/å•å¥TTSä»»åŠ¡ï¼šæ²¡æœ‰è¿›åº¦
{
  "status": "processing",
}
// æ‰¹é‡åˆæˆä»»åŠ¡ï¼Œè¿”å›è¿›åº¦
{
  "status": "processing",
  "progress": {
    "current": 15,
    "total": 50,
    "percent": 30
  }
}

```


Response (Success - æˆåŠŸ):
```
{
  "status": "success",
  "result": { 
    // æˆåŠŸç»“æœï¼šå¦‚æœæ˜¯TTSä»»åŠ¡ï¼Œè¿”å›çš„å°±æ˜¯wavçš„URL
    "audio_url": "/static/temp/preview_xyz.wav" 
    // åˆ†æ/å‰§æœ¬ä»»åŠ¡ï¼šé€šå¸¸è¿”å›ç®€å•çš„ {"message": "ok"}ï¼Œæç¤ºå‰ç«¯å»åˆ·æ–°åˆ—è¡¨æ¥å£
  }
}
```


Response (Failed - å¤±è´¥):
```
{
  "status": "failed",
  "error": "GPU Out of Memory" // é”™è¯¯åŸå› ï¼Œä¾›å‰ç«¯ Toast æç¤º
}
```

# æœªæ¥æ›´æ–°å†…å®¹
+ LLMåˆ†æè§’è‰²ç‰¹å¾ï¼šå½“å°è¯´éå¸¸é•¿æ—¶ï¼ˆå¤§äº100wå­—ï¼‰ï¼Œæ”¯æŒåˆ‡åˆ†å¤„ç†
+ LLMåˆ‡åˆ†å‰§æœ¬ï¼šæ”¯æŒå¤šçº¿ç¨‹åˆ‡åˆ†åŠ é€Ÿ
+ å¯¹è¯åˆæˆä¸­æ·»åŠ ç¯å¢ƒéŸ³åŠŸèƒ½
+ ä¸¤ä¸ªå¯¹è¯ä¹‹é—´æ”¯æŒæ§åˆ¶é™éŸ³ç‰‡æ®µæ—¶é—´é•¿çŸ­
+ è¾“å…¥æ–‡ä»¶ç±»å‹æ”¯æŒå¤šæ ·åŒ–
+ åˆæˆçš„ä¸œè¥¿æ›´å¤šï¼ŒåŒ…æ‹¬ä¸é™äºæ¸¸æˆã€æ’­å®¢ã€è¯•é¢˜å¬åŠ›ã€æ¼«ç”»ç­‰
+ ç”¨æˆ·åœ¨æ¯æ¬¡rerollåéƒ½å¯èƒ½è§‰å¾—ä¹‹å‰çš„æ›´å¥½ï¼ŒåŠ å…¥å†å²è®°å½•æ›´éš¾
+ æ·»åŠ æ‰¹é‡å¯¼å‡º/æ‰“åŒ…åŠŸèƒ½ï¼Œå¯¼å‡ºzipè¿™ç§
+ å¯¹åˆæˆéŸ³é¢‘æ”¯æŒéŸ³é‡æ§åˆ¶
+ å¼•å…¥ç±»ä¼¼å‰ªè¾‘è½¯ä»¶çš„æ³¢å½¢ç¼–è¾‘å™¨ï¼Œç”¨æˆ·å¯é€šè¿‡æ‹–æ‹½éŸ³é¢‘å—å®ç°æ•´æ®µéŸ³é¢‘çš„ç¼–è¾‘
+ æä¾›å­—å¹•æ–‡ä»¶å¯¼å‡ºåŠŸèƒ½
+ ä¸ºå‰§æœ¬åˆ‡åˆ†ã€æ‰¹é‡åˆæˆæä¾›è¿›åº¦æ¡ã€æ˜¾ç¤ºå‰©ä½™æ—¶é—´ç­‰
+ é¡µé¢ 2: è§’è‰²å·¥åŠ æ”¯æŒç”¨æˆ·è‡ªå·±ä¸Šä¼ è‡ªå·±çš„å‚è€ƒéŸ³é¢‘
+ å¯¹äºè€—æ—¶ä»»åŠ¡æ·»åŠ â€œå–æ¶ˆä»»åŠ¡â€API
+ å¯¹äºæ¯ä¸ªprojectï¼ŒçŠ¶æ€æœºä¸ºfailæ—¶ï¼Œæ”¯æŒè‡ªåŠ¨å›åˆ°ä¸Šä¸€ä¸ªçŠ¶æ€é‡è¯•
+ å¯¹äºä»»åŠ¡taskï¼Œå‡å¦‚æ­£åœ¨æœ‰ä»»åŠ¡è¿è¡Œæ—¶åç«¯å®•æœºäº†ï¼Œé‚£projectçš„çŠ¶æ€å°±ä¼šä¸€ç›´å¡æ¯”ï¼Œè¦æ”¯æŒè¿™é‡Œçš„å¼‚å¸¸å¤„ç†
+ è¿”å›æ‰€æœ‰projectå’Œè¿”å›æ‰€æœ‰characterç›®å‰APIä¸ºå…¨éƒ¨è¿”å›ï¼Œåœ¨æ•°æ®é‡å°‘çš„ä¸ªäººåœºæ™¯å¯ç”¨ï¼›ä½†æ˜¯è¿”å›æ‰€æœ‰scriptsæ•°æ®é‡å¯èƒ½è¾ƒå¤§ï¼ˆä¸å°è¯´å­—æ•°å¼ºç›¸å…³ï¼‰ï¼Œéœ€è¦ä¼˜åŒ–ï¼Œä¾‹å¦‚åŠ ä¸Šåˆ†é¡µè¿”å›çš„ç­–ç•¥


---

ç•Œé¢1çš„æµç¨‹ï¼š
åœºæ™¯ 1ï¼šè§’è‰²åˆ†æ (Analyze Characters)
å‰ç«¯ (Page 1): ç”¨æˆ·ç‚¹å‡»â€œå¼€å§‹åˆ†æâ€ã€‚
API (Routers):
æ¥æ”¶è¯·æ±‚ã€‚
å°† Project.state è®¾ä¸º analyzing_characters (å‰ç«¯ç«‹å³çœ‹åˆ°è½¬åœˆ)ã€‚
åˆ›å»º Task (type=analyze_char, project_id=xxx)ã€‚
db.commit() å¹¶è¿”å› task_idã€‚
Worker:
æ£€æµ‹åˆ° Pending ä»»åŠ¡ã€‚
Task å˜ processingã€‚
LLM Handler é€»è¾‘: è¯»å–å°è¯´å†…å®¹ -> è°ƒç”¨ LLM -> è§£æ JSON -> å¾€ Character è¡¨æ’å…¥æ•°æ®ã€‚
Task å˜ successã€‚
State Machine: Project.state å˜ characters_readyã€‚
å‰ç«¯ (è½®è¯¢):
ä¸‹ä¸€æ¬¡è½®è¯¢å‘ç° state å˜äº†ï¼Œè‡ªåŠ¨è·³è½¬åˆ° Page 2ã€‚


